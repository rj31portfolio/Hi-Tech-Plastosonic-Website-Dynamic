$.fn.imageLoader = function() {
    $(this).one("load", function() {}).each(function() {
        this.complete && $(this).load()
    })
};
var productGalleryObj = {
    init: function() {
        var e = $(".productGallery").find(".bxslider.small");
        $.each(e, function(a, i) {
            $(e[a]).bxSlider({
                infiniteLoop: !1,
                minSlides: 3,
                maxSlides: 3,
                slideMargin: 5,
                moveSlides: 1,
                pager: !1,
                speed: 1e3,
                hideControlOnEnd: !0,
                slideWidth: 80,
                responsive: !1,
                controls: !0,
                pagerCustom: "#bx-pager",
                onSliderLoad: function() {
                    a === e.length - 1 && $(i).parents(".productTabs").tabPlugIn(function(e) {
                        var a = $(i).parents(".productTabs").find(".tabContent.videos"),
                            i = a.find(".previewWrapper"),
                            t = a.find(".thumbnailWrapper"),
                            r = i.find("> iframe");
                        if ($(e).find("a").hasClass("tabPictures")) r.attr("src", "");
                        else if ($(e).find("a").hasClass("tabVideos")) {
                            r.attr("src", "");
                            var n = "http://www.youtube.com/embed/" + t.find(".bxslider li a.active").attr("href");
                            r.attr("src", n)
                        }
                    })
                }
            }), productGalleryObj.buildPhoto(i), productGalleryObj.buildVideo(i)
        })
    },
    buildPhoto: function(e) {
        var a = $(e).parents(".thumbnailWrapper");
        $(a).find(".bxslider > li > a").each(function(e, i) {
            var t = $(this),
                e = $("<a></a>");
            e.attr({
                href: t.attr("href"),
                "data-lightbox": t.attr("data-group"),
                "data-title": t.attr("data-group-title")
            });
            var i = $("<img>");
            i.attr({
                src: t.attr("href"),
                alt: t.find("img").attr("alt") ? t.find("img").attr("alt") : ""
            }), i.appendTo(e);
            var r = $("<span></span>");
            r.addClass("viewLargerBtn"), r.appendTo(e), e.appendTo($(a).prev()), 0 === t.parents(".bxslider li").index() ? e.addClass("active") : e.removeClass("active")
        }), this.bindPhotoEvent(a)
    },
    bindPhotoEvent: function(e) {
        var a = $(e).prev();
        $(a).find("a.active img").imageLoader(), $(e).find(".bxslider > li > a").on("click", function(i) {
            i.preventDefault();
            var t = $(this);
            $(e).find(".bxslider > li > a").removeClass("active"), t.addClass("active");
            var r = t.parents(".bxslider > li").index(),
                n = t.parents(".photos");
            $(n).find(".previewWrapper a").removeClass("active"), $(n).find(".previewWrapper a").eq(r).addClass("active"), $(a).find("a.active img").imageLoader()
        })
    },
    buildVideo: function() {
        $(".productTabs a.tabVideos").parent("li").hasClass("active") && (e = $(".videos .thumbnailWrapper .bxslider > li").eq(0).find("a").attr("href"));
        var e, a = $("<iframe></iframe>");
        a.attr({
            width: "100%",
            height: "360",
            frameborder: 0,
            allowfullscreen: "allowfullscreen",
            src: e ? "http://www.youtube.com/embed/" + e + "?wmode=opaque" : "",
            type: "text/html"
        }), a.appendTo(".videos .previewWrapper"), this.bindVideoEvent()
    },
    bindVideoEvent: function() {
        $(".videos .thumbnailWrapper .bxslider > li > a").on("click", function(e) {
            e.preventDefault();
            var a = $(this);
            $(".videos .thumbnailWrapper .bxslider > li > a").removeClass("active"), a.addClass("active"), $(".previewWrapper > iframe").attr("src", "");
            var i = "http://www.youtube.com/embed/" + a.attr("href");
            $(".previewWrapper > iframe").attr("src", i)
        })
    }
};
$(document).ready(function(e) {
    productGalleryObj.init()
});